/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

!function(e,define){define(["./kendo.list.min","./kendo.mobile.scroller.min"],e)}(function(){return function(e,t){function n(e,t,n){return n?t.substring(0,e).split(n).length-1:0}function a(e,t,a){return t.split(a)[n(e,t,a)]}function o(e,t,a,o){var r=t.split(o);return r.splice(n(e,t,o),1,a),o&&""!==r[r.length-1]&&r.push(""),r.join(o)}var r=window.kendo,i=r.support,s=r.caret,l=r._activeElement,u=i.placeholder,c=r.ui,d=c.List,p=r.keys,f=r.data.DataSource,h="aria-disabled",g="aria-readonly",m="k-state-default",v="disabled",_="readonly",k="k-state-focused",y="k-state-selected",w="k-state-disabled",$="k-state-hover",b=".kendoAutoComplete",x="mouseenter"+b+" mouseleave"+b,C=e.proxy,S=d.extend({init:function(t,n){var a,o=this;o.ns=b,n=e.isArray(n)?{dataSource:n}:n,d.fn.init.call(o,t,n),t=o.element,n=o.options,n.placeholder=n.placeholder||t.attr("placeholder"),u&&t.attr("placeholder",n.placeholder),o._wrapper(),o._loader(),o._dataSource(),o._ignoreCase(),t[0].type="text",a=o.wrapper,o._popup(),t.addClass("k-input").on("keydown"+b,C(o._keydown,o)).on("paste"+b,C(o._search,o)).on("focus"+b,function(){o._prev=o._accessor(),o._placeholder(!1),a.addClass(k)}).on("focusout"+b,function(){o._change(),o._placeholder(),a.removeClass(k)}).attr({autocomplete:"off",role:"textbox","aria-haspopup":!0}),o._enable(),o._old=o._accessor(),t[0].id&&t.attr("aria-owns",o.ul[0].id),o._aria(),o._placeholder(),r.notify(o)},options:{name:"AutoComplete",enabled:!0,suggest:!1,template:"",dataTextField:"",minLength:1,delay:200,height:200,filter:"startswith",ignoreCase:!0,highlightFirst:!1,separator:null,placeholder:"",animation:{},value:null},_dataSource:function(){var e=this;e.dataSource&&e._refreshHandler?e._unbindDataSource():(e._refreshHandler=C(e.refresh,e),e._progressHandler=C(e._showBusy,e)),e.dataSource=f.create(e.options.dataSource).bind("change",e._refreshHandler).bind("progress",e._progressHandler)},setDataSource:function(e){this.options.dataSource=e,this._dataSource()},events:["open","close","change","select","dataBinding","dataBound"],setOptions:function(e){d.fn.setOptions.call(this,e),this._template(),this._accessors(),this._aria()},_editable:function(e){var t=this,n=t.element,a=t.wrapper.off(b),o=e.readonly,r=e.disable;o||r?(a.addClass(r?w:m).removeClass(r?m:w),n.attr(v,r).attr(_,o).attr(h,r).attr(g,o)):(a.addClass(m).removeClass(w).on(x,t._toggleHover),n.removeAttr(v).removeAttr(_).attr(h,!1).attr(g,!1))},close:function(){var e=this,t=e._current;t&&t.removeClass(y),e.current(null),e.popup.close()},destroy:function(){var e=this;e.element.off(b),e.wrapper.off(b),d.fn.destroy.call(e)},refresh:function(){var n,a=this,o=a.ul[0],i=a.popup,s=a.options,u=a._data(),c=u.length,d=a.element[0]===l();a._angularItems("cleanup"),a.trigger("dataBinding"),o.innerHTML=r.render(a.template,u),a._height(c),i.visible()&&i._position(),c&&(s.highlightFirst&&a.current(e(o.firstChild)),s.suggest&&d&&a.suggest(e(o.firstChild))),a._open&&(a._open=!1,n=c?"open":"close",a._typing&&!d&&(n="close"),i[n](),a._typing=t),a._touchScroller&&a._touchScroller.reset(),a._makeUnselectable(),a._hideBusy(),a._angularItems("compile"),a.trigger("dataBound")},select:function(e){this._select(e)},search:function(e){var t,n=this,o=n.options,r=o.ignoreCase,i=o.separator;e=e||n._accessor(),n._current=null,clearTimeout(n._typing),i&&(e=a(s(n.element)[0],e,i)),t=e.length,t?t>=n.options.minLength&&(n._open=!0,n._filterSource({value:r?e.toLowerCase():e,operator:o.filter,field:o.dataTextField,ignoreCase:r})):n.popup.close()},suggest:function(e){var a,o=this,r=o._last,i=o._accessor(),u=o.element[0],c=s(u)[0],f=o.options.separator,h=i.split(f),g=n(c,i,f),m=c;return r==p.BACKSPACE||r==p.DELETE?(o._last=t,t):(e=e||"","string"!=typeof e&&(a=d.inArray(e[0],o.ul[0]),e=a>-1?o._text(o._data()[a]):""),0>=c&&(c=i.toLowerCase().indexOf(e.toLowerCase())+1),a=i.substring(0,c).lastIndexOf(f),a=a>-1?c-(a+f.length):c,i=h[g].substring(0,a),e&&(a=e.toLowerCase().indexOf(i.toLowerCase()),a>-1&&(e=e.substring(a+i.length),m=c+e.length,i+=e),f&&""!==h[h.length-1]&&h.push("")),h[g]=i,o._accessor(h.join(f||"")),u===l()&&s(u,c,m),t)},value:function(e){return e===t?this._accessor():(this._accessor(e),this._old=this._accessor(),t)},_accessor:function(e){var n=this,a=n.element[0];return e===t?(e=a.value,a.className.indexOf("k-readonly")>-1?e===n.options.placeholder?"":e:e):(a.value=null===e?"":e,n._placeholder(),t)},_accept:function(e){var t=this.element;this._focus(e),s(t,t.val().length)},_keydown:function(t){var n=this,a=n.ul[0],o=t.keyCode,r=n._current,i=n.popup.visible();n._last=o,o===p.DOWN?(i&&n._move(r?r.next():e(a.firstChild)),t.preventDefault()):o===p.UP?(i&&n._move(r?r.prev():e(a.lastChild)),t.preventDefault()):o===p.ENTER||o===p.TAB?(o===p.ENTER&&n.popup.visible()&&t.preventDefault(),n._accept(r)):o===p.ESC?(n.popup.visible()&&t.preventDefault(),n.close()):n._search()},_move:function(e){var t=this;e=e[0]?e:null,t.current(e),t.options.suggest&&t.suggest(e)},_hideBusy:function(){var e=this;clearTimeout(e._busy),e._loading.hide(),e.element.attr("aria-busy",!1),e._busy=null},_showBusy:function(){var e=this;e._busy||(e._busy=setTimeout(function(){e.element.attr("aria-busy",!0),e._loading.show()},100))},_placeholder:function(e){if(!u){var n,a=this,o=a.element,r=a.options.placeholder;if(r){if(n=o.val(),e===t&&(e=!n),e||(r=n!==r?n:""),n===a._old&&!e)return;o.toggleClass("k-readonly",e).val(r),r||o[0]!==document.activeElement||s(o[0],0,0)}}},_search:function(){var e=this;clearTimeout(e._typing),e._typing=setTimeout(function(){e._prev!==e._accessor()&&(e._prev=e._accessor(),e.search())},e.options.delay)},_select:function(t){var n,a,r=this,i=r.options.separator,l=r._data();t=e(t),t[0]&&!t.hasClass(y)&&(a=d.inArray(t[0],r.ul[0]),a>-1&&(l=l[a],n=r._text(l),i&&(n=o(s(r.element)[0],r._accessor(),n,i)),r._accessor(n),r._prev=r._accessor(),r.current(t.addClass(y))))},_loader:function(){this._loading=e('<span class="k-icon k-loading" style="display:none"></span>').insertAfter(this.element)},_toggleHover:function(t){e(t.currentTarget).toggleClass($,"mouseenter"===t.type)},_wrapper:function(){var e,t=this,n=t.element,a=n[0];e=n.parent(),e.is("span.k-widget")||(e=n.wrap("<span />").parent()),e.attr("tabindex",-1),e.attr("role","presentation"),e[0].style.cssText=a.style.cssText,n.css({width:"100%",height:a.style.height}),t._focused=t.element,t.wrapper=e.addClass("k-widget k-autocomplete k-header").addClass(a.className)}});c.plugin(S)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});